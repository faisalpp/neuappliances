import{a0 as u,r as l,j as e,bQ as Ue,aJ as w,aR as de,A as Oe,u as Te,$ as Me,q as m,ag as Ze,ah as h,bH as He,bG as Ke,bR as ee,bS as se,bT as te,ai as b,aH as Qe,L as ze,aG as Ge,bU as ae,bV as Ve,bW as j,bX as N,bY as Ye,bZ as Je,b_ as We,aY as re,aZ as le}from"./index-08dd1ef5.js";import{C as Xe,B as es,L as ss}from"./LeftArrowSvg-989b2970.js";import{R as F}from"./ReviewDetail-4072606e.js";import{C as ie}from"./CustomSelect-0b267130.js";import"./CustomInput-31880599.js";const ts=()=>{const x=u(d=>d.admin._id),i=u(d=>d.user._id);if(x)return!0;if(i&&!x||!x&&!i)return!1},ne=({id:x,title:i,labelImage:d,checked:r,name:n,customStyle:p,change:y})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(w.Radio,{id:x,onChange:f=>y(f),icon:e.jsx(de,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:n,label:e.jsx("div",{children:e.jsxs(w.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[d?e.jsx("img",{src:"/payment/"+d,className:"h-[23px] object-contain",alt:i}):null,e.jsx("span",{className:p,children:i})]})}),checked:r})}),U=({id:x,title:i,labelImage:d,checked:r,name:n,customStyle:p,change:y})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(w.Radio,{id:x,onChange:f=>y(f),icon:e.jsx(de,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:n,label:e.jsx("div",{children:e.jsxs(w.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[(d==null?void 0:d.length)>0?d.map(f=>e.jsx("img",{src:"/payment/"+f,className:"h-[23px] object-contain",alt:i})):null,e.jsx("span",{className:p,children:i})]})}),checked:r===n})}),as=({CardNumber:x,CardExpiry:i,CardCvc:d,handleCardPayment:r,payment:n,setPayment:p,setBilling:y,billing:f})=>{const[S,k]=l.useState(!0),R=P=>{const v=P.target;v.name==="shipping_address"&&(k(v.checked),y(!1)),v.name==="billing_address"&&(y(v.checked),k(!1))},A=P=>{p(P.target.name)};return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Payment"}),e.jsxs("p",{className:"flex gap-1 items-center text-sm text-b32 font-medium",children:[e.jsx(Ue,{className:"text-b3 text-xs"})," All transactions are secure and encrypted."]}),e.jsxs("div",{className:"[&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(U,{customStyle:"font-medium",change:A,name:"card",id:"credit_card",checked:n,labelImage:["visa.png","master.png","express.png"]}),e.jsxs("form",{onSubmit:r,className:"p-4 bg-[#F9F9F9] grid grid-cols-1 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsxs("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:[e.jsx(x,{className:"py-3"}),e.jsx("div",{className:"absolute right-4 top-0 h-full flex items-center",children:e.jsx("img",{className:"w-[18px] h-[18px]",src:"/svgs/lock.webp"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(i,{className:"py-3"})})}),e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(d,{className:"py-3"})})})]})]}),e.jsx(U,{name:"paypal",change:A,checked:n,labelImage:["pay_paypal.webp"],id:"paypal"}),e.jsx(U,{name:"affirm",change:A,checked:n,id:"affirm",labelImage:["affirm.webp"]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Billing address"}),e.jsx("p",{className:"flex gap-1 items-center text-sm text-b32",children:"Select the address that matches your card of payment method."}),e.jsxs("div",{className:"mt-14px [&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(ne,{checked:S,change:R,name:"shipping_address",id:"shipping_address",title:"Same as shipping address"}),e.jsx(ne,{checked:f,change:R,name:"billing_address",id:"billing_address",title:"Use a different billing address"})]})]})]})},rs=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed flex flex-col space-y-5 items-center justify-center top-0 w-full h-screen z-40 bg-white/80",children:[e.jsx(Oe,{className:"text-b6 text-6xl animate-spin"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Your orderâ€™s being processed."}),e.jsx("p",{className:"font-medium text-sm",children:"Please wait while we process your order."})]})]})}),us=()=>{const[x,i]=l.useState(!1),d=Te(),r=Me(),n=u(s=>s.cart.deliveryOrders),p=u(s=>s.cart.pickupOrders);l.useEffect(()=>{(n==null?void 0:n.length)===0&&(p==null?void 0:p.length)===0&&(m("Cart is Empty","error",1e3),d("/mycart"))},[]);const{email:y,address:f,postalCode:S,city:k,country:R,province:A}=u(s=>s.order.orderInfo)||{},P=u(s=>s.cart.deliveryInfo),v=[{name:"USA",value:"us"}],ce=[{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"}],[_,oe]=l.useState(""),[O,me]=l.useState(!1),[T,ue]=l.useState(""),[M,pe]=l.useState(""),[Z,xe]=l.useState(""),[H,he]=l.useState(""),[K,fe]=l.useState(""),[ge,ye]=l.useState("usa"),[be,je]=l.useState("alberta"),[I,Ne]=l.useState(""),[Q,ve]=l.useState(""),[Ce,we]=l.useState(!1),Se=Ze().shape({email:h().required("Email is Required!"),firstName:h().nullable(),lastName:h().required("Last Name is Required!"),address:h().required("Address is Required!"),appartment:h().nullable(),city:h().required("City is Required!"),country:h().required("Country is Required!"),province:h().required("Province is Required!"),postalCode:h().required("Postal Code is Required!"),phone:h().required("Phone is Required!")}),[Ae,$]=l.useState(!1),Pe=async()=>{$(!0);const s=await CheckZip({zip:I});console.log(s),s.status==200,$(!1)};l.useEffect(()=>{I.length===5&&Pe()},[I]);const z=s=>{const{name:t,checked:o}=s.target;t==="keepUpdates"&&me(o),t==="saveAddress"&&we(o)},[L,ke]=l.useState(!1),[G,Re]=l.useState("card"),[c,V]=l.useState(!1),[q,ls]=l.useState([]),[qe,is]=l.useState((n==null?void 0:n.length)>0?"delivery":"pickup"),Ee=async()=>{try{const s={email:_,firstName:T,lastName:M,address:Z,appartment:H,city:K,country:ge,state:be,postalCode:S,phone:Q};return await Se.validate(s,{abortEarly:!1}),O&&q.push(_),{status:!0,data:s}}catch(s){if(s){let t=s.errors;return V(t),t.forEach(o=>{m(o,"error",1e3)}),{status:!1}}else V([])}},a=u(s=>s.order.orderInfo),Y=u(s=>s.cart.cartId),Fe=u(s=>s.user._id),_e=u(s=>s.user.auth),g=u(s=>s.order.orderErrors),D=u(s=>s.order.orderStatus),Ie=ts(),E=He(),B=Ke(),$e=async s=>{m("Paypal Transaction!","success",1e3)},Le=async s=>{const t=await ae({price:2e4,mode:["affirm"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if(t)return await B.confirmAffirmPayment(t.data.payIntent.client_secret,{payment_method:{billing_details:{email:a.email,name:a.firstName,address:{line1:a.address,city:a.city,state:a.state,postal_code:a.postalCode,country:"US"}}},shipping:{name:"Koner Doe",address:{line1:"address line 1",line2:"address line 2",city:"city",state:"CA",postal_code:"73301",country:"US"}},return_url:"http://localhost:5173/mycart/payment/?callback=affirm"});m("Affirm Transaction!","error",1e3)},J=async s=>{const t=E.getElement(ee);E.getElement(se),E.getElement(te);const o=await ae({price:200*100,mode:["card"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if(o)return await B.confirmCardPayment(o.data.payIntent.client_secret,{payment_method:{card:t,billing_details:{name:`${a.firstName} ${a.lastName}`,email:a.email,address:{line1:a.address,city:a.city,country:"us",postal_code:a.postalCode,state:a.state}}}});m("Payment Intent Error!","error",1e3)},W=async(s,t)=>{if(g.confirm||!D.confirm){const o=await We({orderNo:t,intent:s,cartId:Y});console.log(o),o.status===200?(j({confirm:!1}),N({confirm:!0}),m(o.data.msg,"success",1e3),r(re()),r(le()),i(!1),d("/")):(j({confirm:!0}),N({confirm:!1}),m(o.data.message,"error",1e3),i(!1))}else m("Order Already Complete!","success",1e3),r(re()),r(le()),i(!1),d("/")},De=u(s=>s.order.paymentIntent),X=async s=>{if(g.payment||!D.payment){if(!B&&!E){m("Stripe Not Loaded!","error",100),r(j({payment:!0})),r(N({payment:!1})),i(!1);return}let t;switch(G){case"card":t=await J();break;case"paypal":await $e();break;case"affirm":t=await Le();break}console.log(t),t!=null&&t.error?(r(j({payment:!0})),r(N({payment:!1})),i(!1),m(t.error.code,"error",1e3)):(r(j({payment:!1})),r(N({payment:!0})),r(Je(t.paymentIntent)),W(t.paymentIntent,s))}else W(De)},Be=async s=>{if(s.preventDefault(),i(!0),g.order||!D.order){let t={status:!1};if(L?(a!=null&&a.keepUpdates&&q.push(a.email),t=await Ee()):(a!=null&&a.keepUpdates&&q.push(a.email),t={status:!0,data:{...a}}),t.status){const o={userId:Fe,isAdmin:Ie,isAuth:_e,cartId:Y,orderType:qe,shippingAddress:a,billingInfo:t.data,newsEmail:q},C=await Ve(o);console.log(C.data),C.status===200?(r(j({order:!1})),r(N({order:!0})),r(Ye(C.data.orderNo)),X(C.data.orderNo)):(r(j({order:!0})),r(N({order:!1})),m(C.data.message,"error",1e3),i(!1))}else m("Billing Address Not Found!","error",1e3),i(!1)}else m("Order Already Placed...","success",1e3),X()};return e.jsxs(e.Fragment,{children:[x?e.jsx(rs,{}):null,e.jsxs(Xe,{children:[e.jsx("img",{src:"/login_logo.webp",alt:""}),e.jsx(es,{}),e.jsxs("div",{className:"border border-b31 p-3 flex flex-col gap-3 rounded-md",children:[e.jsx(F,{title:"Contact",detail:y,textStyle:"font-medium"}),e.jsx("hr",{}),e.jsx(F,{title:"Ship to",detail:`${f},${k} ,${A}, ${R},${S}`,textStyle:"font-medium"}),e.jsx("hr",{}),(n==null?void 0:n.length)>0?e.jsx(F,{title:"Method",detail:`Home Delivery Â· $${P.shipping}`,subtitle:"1 to 3 Business Days",textStyle:"font-medium"}):null,(p==null?void 0:p.length)>0?e.jsx(F,{title:"Method",detail:"Self Pickup Â· Free",subtitle:"Always Ready!",textStyle:"font-medium"}):null]}),e.jsx(as,{CardNumber:ee,CardExpiry:se,CardCvc:te,handleCardPayment:J,payment:G,setPayment:Re,billing:L,setBilling:ke}),e.jsxs("div",{className:`${L?"flex flex-col":"hidden"} duration-300  border-[1px] border-b31 rounded-md mt-3 px-4 py-4`,children:[e.jsxs("div",{className:"space-y-14px [&>*]:text-b16 [&>*]:text-sm",children:[e.jsx("h3",{className:"!text-lg font-medium text-b16",children:"Billing information"}),e.jsx(b,{width:"full",name:"Email",title:"Email",iscompulsory:"false",type:"text",value:_,onChange:s=>oe(s.target.value),error:!!(c&&c.includes("Email is Required!")),errormessage:"Email is Required!",placeholder:"abc@gmail.com"}),e.jsx(w.Checkbox,{onChange:s=>z(s),checked:O,defaultChecked:!1,name:"keepUpdates",id:"keep-me-update",label:"Keep me up to date on news and exclusive offers",className:"checked:bg-black border-b31",ripple:!1})]}),e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-b16",children:"Shipping address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(b,{width:"full",name:"firstName",title:"",iscompulsory:"false",type:"text",value:T,onChange:s=>ue(s.target.value),error:!!(c&&c.includes("First Name is Required!")),errormessage:"First Name is Required!",placeholder:"First Name (optional)"}),e.jsx(b,{width:"full",name:"lastName",title:"",iscompulsory:"false",type:"text",value:M,onChange:s=>pe(s.target.value),error:!!(c&&c.includes("Last Name is Required!")),errormessage:"Last Name is Required!",placeholder:"Last Name"}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsx(b,{width:"full",name:"address",title:"",iscompulsory:"false",type:"text",value:Z,onChange:s=>xe(s.target.value),error:!!(c&&c.includes("Address is Required!")),errormessage:"Address is Required!",placeholder:"Address"}),e.jsx(b,{width:"full",name:"appartment",title:"",iscompulsory:"false",type:"text",value:H,onChange:s=>he(s.target.value),error:!!(c&&c.includes("Apartment, suite is Required!")),errormessage:"Apartment, suite is Required!",placeholder:"Apartment, suite, etc. (optional)"}),e.jsx(b,{width:"full",name:"city",title:"",iscompulsory:"false",type:"text",value:K,onChange:s=>fe(s.target.value),error:!!(c&&c.includes("City is Required!")),errormessage:"City is Required!",placeholder:"City"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-14px",children:[e.jsx(ie,{setState:ye,id:"country_region",label:"Country / region",Options:v}),e.jsx(ie,{setState:je,id:"province",label:"Province",Options:ce}),e.jsxs("div",{className:"relative  col-span-2 md:col-span-1 [&>*]:h-full",children:[Ae?e.jsx("div",{className:"absolute flex rounded-lg items-center w-full justify-end px-2",children:e.jsx("img",{src:"/loader-bg.gif",className:"w-4 h-4"})}):null,e.jsx(b,{width:"full",name:"postalCode",title:"",iscompulsory:"false",type:"text",value:S,onChange:s=>Ne(s.target.value),error:!!(c&&c.includes("Postal Code is Required!")),errormessage:"Postal Code is Required!",placeholder:"Postal Code"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{width:"full",name:"phone",title:"",iscompulsory:"false",type:"text",value:Q,onChange:s=>ve(s.target.value),error:!!(c&&c.includes("Phone is Required!")),errormessage:"Phone is Required!",placeholder:"Phone"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(Qe,{className:"text-2xl text-b3"})})]}),e.jsx("div",{className:"[&>*]:text-b16 [&>*]:text-sm",children:e.jsx(w.Checkbox,{onChange:s=>z(s),id:"save-information",name:"saveAddress",checked:Ce,defaultChecked:!1,label:"Save this information for next time",className:"checked:bg-black border-b31",ripple:!1})})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full mt-5",children:[e.jsxs(ze,{to:"/mycart/shipping",className:"flex gap-1 items-center",children:[e.jsx(ss,{}),e.jsx("span",{className:"text-sm font-medium text-b3",children:"Return to shipping"})]}),e.jsx("button",{type:"button",onClick:Be,className:`flex space-x-1 cursor-pointer py-3 px-6 text-xs rounded-lg ${g.order||g.payment||g.confirm?"bg-red-500":"bg-b3"} text-white`,children:g.order||g.payment||g.confirm?e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("span",{children:"Try Again"})," ",e.jsx(Ge,{className:"text-white text-sm"})]}):e.jsx("span",{children:"Pay Now"})})]})]})]})};export{us as default};
