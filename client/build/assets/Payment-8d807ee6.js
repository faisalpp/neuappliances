import{a5 as m,r,j as e,bY as Be,aW as w,b4 as ce,bZ as De,u as Ue,a6 as Te,w as o,p as Me,q as h,b_ as Ze,b$ as ze,c0 as se,c1 as te,c2 as ae,av as g,aU as He,L as Je,aS as Ke,c3 as re,c4 as Qe,c5 as N,c6 as v,c7 as Ve,c8 as We,c9 as Ye,ap as ie,aq as ne}from"./index-820351db.js";import{C as Ge,B as Xe,L as es}from"./LeftArrowSvg-8d482f9e.js";import{R as E}from"./ReviewDetail-401392bf.js";import{C as le}from"./CustomSelect-a669b826.js";import"./CustomInput-34acc87d.js";const ss=()=>{const p=m(n=>n.admin._id),i=m(n=>n.user._id);if(p)return!0;if(i&&!p||!p&&!i)return!1},de=({id:p,title:i,labelImage:n,checked:a,name:u,customStyle:b,change:y})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(w.Radio,{id:p,onChange:x=>y(x),icon:e.jsx(ce,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:u,label:e.jsx("div",{children:e.jsxs(w.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[n?e.jsx("img",{src:"/payment/"+n,className:"h-[23px] object-contain",alt:i}):null,e.jsx("span",{className:b,children:i})]})}),checked:a})}),D=({id:p,title:i,labelImage:n,checked:a,name:u,customStyle:b,change:y})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(w.Radio,{id:p,onChange:x=>y(x),icon:e.jsx(ce,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:u,label:e.jsx("div",{children:e.jsxs(w.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[(n==null?void 0:n.length)>0?n.map(x=>e.jsx("img",{src:"/payment/"+x,className:"h-[23px] object-contain",alt:i})):null,e.jsx("span",{className:b,children:i})]})}),checked:a===u})}),ts=({CardNumber:p,CardExpiry:i,CardCvc:n,handleCardPayment:a,payment:u,setPayment:b,setBilling:y,billing:x})=>{const[F,A]=r.useState(!0),P=S=>{const C=S.target;C.name==="shipping_address"&&(A(C.checked),y(!1)),C.name==="billing_address"&&(y(C.checked),A(!1))},j=S=>{b(S.target.name)};return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Payment"}),e.jsxs("p",{className:"flex gap-1 items-center text-sm text-b32 font-medium",children:[e.jsx(Be,{className:"text-b3 text-xs"})," All transactions are secure and encrypted."]}),e.jsxs("div",{className:"[&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(D,{customStyle:"font-medium",change:j,name:"card",id:"credit_card",checked:u,labelImage:["visa.png","master.png","express.png"]}),e.jsxs("form",{onSubmit:a,className:"p-4 bg-[#F9F9F9] grid grid-cols-1 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsxs("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:[e.jsx(p,{className:"py-3"}),e.jsx("div",{className:"absolute right-4 top-0 h-full flex items-center",children:e.jsx("img",{className:"w-[18px] h-[18px]",src:"/svgs/lock.webp"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(i,{className:"py-3"})})}),e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(n,{className:"py-3"})})})]})]}),e.jsx(D,{name:"paypal",change:j,checked:u,labelImage:["pay_paypal.webp"],id:"paypal"}),e.jsx(D,{name:"affirm",change:j,checked:u,id:"affirm",labelImage:["affirm.webp"]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Billing address"}),e.jsx("p",{className:"flex gap-1 items-center text-sm text-b32",children:"Select the address that matches your card of payment method."}),e.jsxs("div",{className:"mt-14px [&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(de,{checked:F,change:P,name:"shipping_address",id:"shipping_address",title:"Same as shipping address"}),e.jsx(de,{checked:x,change:P,name:"billing_address",id:"billing_address",title:"Use a different billing address"})]})]})]})},as=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed flex flex-col space-y-5 items-center justify-center top-0 w-full h-screen z-40 bg-white/80",children:[e.jsx(De,{className:"text-b6 text-6xl animate-spin"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Your order’s being processed."}),e.jsx("p",{className:"font-medium text-sm",children:"Please wait while we process your order."})]})]})}),os=()=>{const[p,i]=r.useState(!1),n=Ue(),a=Te(),u=m(s=>{var t;return(t=s.cart)==null?void 0:t.cart.products});r.useEffect(()=>{(u==null?void 0:u.length)===0&&(o("Cart is Empty","error",1e3),n("/mycart"))},[]);const{email:b,address:y,postalCode:x,city:F,country:A,province:P}=m(s=>s.order.orderInfo)||{},j=m(s=>{var t;return(t=s.cart)==null?void 0:t.cart.orderInfo}),S=[{name:"USA",value:"us"}],C=[{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"}],[_,oe]=r.useState(""),[U,me]=r.useState(!1),[T,ue]=r.useState(""),[M,pe]=r.useState(""),[Z,xe]=r.useState(""),[z,he]=r.useState(""),[H,fe]=r.useState(""),[ye,ge]=r.useState("usa"),[be,je]=r.useState("alberta"),[I,Ne]=r.useState(""),[J,ve]=r.useState(""),[Ce,we]=r.useState(!1),Se=Me().shape({email:h().required("Email is Required!"),firstName:h().nullable(),lastName:h().required("Last Name is Required!"),address:h().required("Address is Required!"),appartment:h().nullable(),city:h().required("City is Required!"),country:h().required("Country is Required!"),province:h().required("Province is Required!"),postalCode:h().required("Postal Code is Required!"),phone:h().required("Phone is Required!")}),[ke,O]=r.useState(!1),Ae=async()=>{O(!0),(await CheckZip({zip:I})).status==200,O(!1)};r.useEffect(()=>{I.length===5&&Ae()},[I]);const K=s=>{const{name:t,checked:c}=s.target;t==="keepUpdates"&&me(c),t==="saveAddress"&&we(c)},[$,Pe]=r.useState(!1),[Q,Re]=r.useState("card"),[d,V]=r.useState(!1),[R,rs]=r.useState([]),qe=async()=>{try{const s={email:_,firstName:T,lastName:M,address:Z,appartment:z,city:H,country:ye,state:be,postalCode:x,phone:J};return await Se.validate(s,{abortEarly:!1}),U&&R.push(_),{status:!0,data:s}}catch(s){if(s){let t=s.errors;return V(t),t.forEach(c=>{o(c,"error",1e3)}),{status:!1}}else V([])}},l=m(s=>s.order.orderInfo),W=m(s=>{var t;return(t=s.cart)==null?void 0:t.cart.grandTotal}),Y=m(s=>{var t;return(t=s.cart)==null?void 0:t.cart._id}),Ee=m(s=>s.user._id),Fe=m(s=>s.user.auth),f=m(s=>s.order.orderErrors),L=m(s=>s.order.orderStatus),_e=ss(),q=Ze(),B=ze(),Ie=async s=>{o("Paypal Transaction!","success",1e3)},Oe=async s=>{const t=await re({price:W.toFixed(2)*100,mode:["affirm"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if(t)return await B.confirmAffirmPayment(t.data.payIntent.client_secret,{payment_method:{billing_details:{email:"jenny@rosen.com",name:"Jenny Rosen",address:{line1:"1234 Main Street",city:"San Francisco",state:"CA",country:"US",postal_code:"94111"}}},shipping:{name:"Jenny Rosen",address:{line1:"1234 Main Street",city:"San Francisco",state:"CA",country:"US",postal_code:"94111"}},return_url:"http://localhost:5173/mycart/payment/?callback=affirm"});o("Affirm Transaction!","error",1e3)},G=async s=>{const t=q.getElement(se);q.getElement(te),q.getElement(ae);const c=await re({price:W.toFixed(2)*100,mode:["card"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if(console.log(c),c)return await B.confirmCardPayment(c.data.payIntent.client_secret,{payment_method:{card:t,billing_details:{name:`${l.firstName} ${l.lastName}`,email:l.email,address:{line1:l.address,city:l.city,country:"us",postal_code:l.postalCode,state:l.state}}}});o("Payment Intent Error!","error",1e3)},X=async(s,t)=>{if(f.confirm||!L.confirm){const c=await Ye({orderNo:t,intent:s,cartId:Y});c.status===200?(N({confirm:!1}),v({confirm:!0}),o(c.data.msg,"success",1e3),n("/"),a(ie()),i(!1),a(ne())):(N({confirm:!0}),v({confirm:!1}),o(c.data.message,"error",1e3),i(!1))}else o("Order Already Complete!","success",1e3),a(ie()),a(ne()),i(!1),n("/")},$e=m(s=>s.order.paymentIntent),ee=async s=>{if(f.payment||!L.payment){if(!B&&!q){o("Stripe Not Loaded!","error",100),a(N({payment:!0})),a(v({payment:!1})),i(!1);return}let t;switch(Q){case"card":t=await G();break;case"paypal":await Ie();break;case"affirm":t=await Oe();break}t!=null&&t.error?(a(N({payment:!0})),a(v({payment:!1})),i(!1),o(t.error.code,"error",1e3)):(a(N({payment:!1})),a(v({payment:!0})),a(We(t.paymentIntent)),X(t.paymentIntent,s))}else X($e)},Le=async s=>{if(s.preventDefault(),i(!0),f.order||!L.order){let t={status:!1};if($?(l!=null&&l.keepUpdates&&R.push(l.email),t=await qe()):(l!=null&&l.keepUpdates&&R.push(l.email),t={status:!0,data:{...l}}),t.status){const c={userId:Ee,isAdmin:_e,isAuth:Fe,cartId:Y,shippingAddress:l,billingInfo:t.data,newsEmail:R},k=await Qe(c);k.status===200?(a(N({order:!1})),a(v({order:!0})),a(Ve(k.data.orderNo)),ee(k.data.orderNo)):(a(N({order:!0})),a(v({order:!1})),o(k.data.message,"error",1e3),i(!1))}else o("Billing Address Not Found!","error",1e3),i(!1)}else o("Order Already Placed...","success",1e3),ee()};return e.jsxs(e.Fragment,{children:[p?e.jsx(as,{}):null,e.jsxs(Ge,{children:[e.jsx("img",{src:"/login_logo.webp",alt:""}),e.jsx(Xe,{}),e.jsxs("div",{className:"border border-b31 p-3 flex flex-col gap-3 rounded-md",children:[e.jsx(E,{title:"Contact",detail:b,textStyle:"font-medium"}),e.jsx("hr",{}),e.jsx(E,{title:"Ship to",detail:`${y},${F} ,${P}, ${A},${x}`,textStyle:"font-medium"}),e.jsx("hr",{}),j.type==="delivery"?e.jsx(E,{title:"Method",detail:`Home Delivery · $${j.shipping}`,subtitle:"2 to 3 Business Days",textStyle:"font-medium"}):null,j.type==="pickup"?e.jsx(E,{title:"Method",detail:"Self Pickup · Free",subtitle:"Always Ready!",textStyle:"font-medium"}):null]}),e.jsx(ts,{CardNumber:se,CardExpiry:te,CardCvc:ae,handleCardPayment:G,payment:Q,setPayment:Re,billing:$,setBilling:Pe}),e.jsxs("div",{className:`${$?"flex flex-col":"hidden"} duration-300  border-[1px] border-b31 rounded-md mt-3 px-4 py-4`,children:[e.jsxs("div",{className:"space-y-14px [&>*]:text-b16 [&>*]:text-sm",children:[e.jsx("h3",{className:"!text-lg font-medium text-b16",children:"Billing information"}),e.jsx(g,{width:"full",name:"Email",title:"Email",iscompulsory:"false",type:"text",value:_,onChange:s=>oe(s.target.value),error:!!(d&&d.includes("Email is Required!")),errormessage:"Email is Required!",placeholder:"abc@gmail.com"}),e.jsx(w.Checkbox,{onChange:s=>K(s),checked:U,defaultChecked:!1,name:"keepUpdates",id:"keep-me-update",label:"Keep me up to date on news and exclusive offers",className:"checked:bg-black border-b31",ripple:!1})]}),e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-b16",children:"Shipping address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(g,{width:"full",name:"firstName",title:"",iscompulsory:"false",type:"text",value:T,onChange:s=>ue(s.target.value),error:!!(d&&d.includes("First Name is Required!")),errormessage:"First Name is Required!",placeholder:"First Name (optional)"}),e.jsx(g,{width:"full",name:"lastName",title:"",iscompulsory:"false",type:"text",value:M,onChange:s=>pe(s.target.value),error:!!(d&&d.includes("Last Name is Required!")),errormessage:"Last Name is Required!",placeholder:"Last Name"}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsx(g,{width:"full",name:"address",title:"",iscompulsory:"false",type:"text",value:Z,onChange:s=>xe(s.target.value),error:!!(d&&d.includes("Address is Required!")),errormessage:"Address is Required!",placeholder:"Address"}),e.jsx(g,{width:"full",name:"appartment",title:"",iscompulsory:"false",type:"text",value:z,onChange:s=>he(s.target.value),error:!!(d&&d.includes("Apartment, suite is Required!")),errormessage:"Apartment, suite is Required!",placeholder:"Apartment, suite, etc. (optional)"}),e.jsx(g,{width:"full",name:"city",title:"",iscompulsory:"false",type:"text",value:H,onChange:s=>fe(s.target.value),error:!!(d&&d.includes("City is Required!")),errormessage:"City is Required!",placeholder:"City"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-14px",children:[e.jsx(le,{setState:ge,id:"country_region",label:"Country / region",Options:S}),e.jsx(le,{setState:je,id:"province",label:"Province",Options:C}),e.jsxs("div",{className:"relative  col-span-2 md:col-span-1 [&>*]:h-full",children:[ke?e.jsx("div",{className:"absolute flex rounded-lg items-center w-full justify-end px-2",children:e.jsx("img",{src:"/loader-bg.gif",className:"w-4 h-4"})}):null,e.jsx(g,{width:"full",name:"postalCode",title:"",iscompulsory:"false",type:"text",value:x,onChange:s=>Ne(s.target.value),error:!!(d&&d.includes("Postal Code is Required!")),errormessage:"Postal Code is Required!",placeholder:"Postal Code"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{width:"full",name:"phone",title:"",iscompulsory:"false",type:"text",value:J,onChange:s=>ve(s.target.value),error:!!(d&&d.includes("Phone is Required!")),errormessage:"Phone is Required!",placeholder:"Phone"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(He,{className:"text-2xl text-b3"})})]}),e.jsx("div",{className:"[&>*]:text-b16 [&>*]:text-sm",children:e.jsx(w.Checkbox,{onChange:s=>K(s),id:"save-information",name:"saveAddress",checked:Ce,defaultChecked:!1,label:"Save this information for next time",className:"checked:bg-black border-b31",ripple:!1})})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full mt-5",children:[e.jsxs(Je,{to:"/mycart/shipping",className:"flex gap-1 items-center",children:[e.jsx(es,{}),e.jsx("span",{className:"text-sm font-medium text-b3",children:"Return to shipping"})]}),e.jsx("button",{type:"button",onClick:Le,className:`flex space-x-1 cursor-pointer py-3 px-6 text-xs rounded-lg ${f.order||f.payment||f.confirm?"bg-red-500":"bg-b3"} text-white`,children:f.order||f.payment||f.confirm?e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("span",{children:"Try Again"})," ",e.jsx(Ke,{className:"text-white text-sm"})]}):e.jsx("span",{children:"Pay Now"})})]})]})]})};export{os as default};
