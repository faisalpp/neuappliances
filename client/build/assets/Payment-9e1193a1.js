import{a5 as n,r as i,j as e,bY as Qe,aW as E,b4 as me,bZ as ze,b_ as ue,a6 as pe,u as xe,b$ as He,w as x,c0 as N,c1 as v,ap as ae,aq as re,c2 as h,c3 as le,c4 as Ke,y as Ye,p as Ge,q as j,c5 as Ie,c6 as ie,c7 as ne,c8 as de,av as R,aU as Ve,L as We,aS as Je,c9 as Xe,ca as es,cb as ss}from"./index-a2ecda28.js";import{C as ts,B as as,L as rs}from"./LeftArrowSvg-063f9513.js";import{R as B}from"./ReviewDetail-72cb56dd.js";import{C as ce}from"./CustomSelect-21b6211f.js";import"./CustomInput-9bd1931b.js";const ls=()=>{const r=n(d=>d.admin._id),t=n(d=>d.user._id);if(r)return!0;if(t&&!r||!r&&!t)return!1},oe=({id:r,title:t,labelImage:d,checked:C,name:f,customStyle:w,change:o})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(E.Radio,{id:r,onChange:y=>o(y),icon:e.jsx(me,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:f,label:e.jsx("div",{children:e.jsxs(E.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[d?e.jsx("img",{src:"/payment/"+d,className:"h-[23px] object-contain",alt:t}):null,e.jsx("span",{className:w,children:t})]})}),checked:C})}),Q=({id:r,title:t,labelImage:d,checked:C,name:f,customStyle:w,change:o})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(E.Radio,{id:r,onChange:y=>o(y),icon:e.jsx(me,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:f,label:e.jsx("div",{children:e.jsxs(E.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[(d==null?void 0:d.length)>0?d.map(y=>e.jsx("img",{src:"/payment/"+y,className:"h-[23px] object-contain",alt:t})):null,e.jsx("span",{className:w,children:t})]})}),checked:C===f})}),is=({CardNumber:r,CardExpiry:t,CardCvc:d,handleCardPayment:C,payment:f,setPayment:w,setBilling:o,billing:y})=>{const[O,q]=i.useState(!0),_=u=>{const c=u.target;c.name==="shipping_address"&&(q(c.checked),o(!1)),c.name==="billing_address"&&(o(c.checked),q(!1))},l=u=>{w(u.target.name)};return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Payment"}),e.jsxs("p",{className:"flex gap-1 items-center text-sm text-b32 font-medium",children:[e.jsx(Qe,{className:"text-b3 text-xs"})," All transactions are secure and encrypted."]}),e.jsxs("div",{className:"[&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(Q,{customStyle:"font-medium",change:l,name:"card",id:"credit_card",checked:f,labelImage:["visa.png","master.png","express.png"]}),e.jsxs("form",{onSubmit:C,className:"p-4 bg-[#F9F9F9] grid grid-cols-1 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsxs("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:[e.jsx(r,{className:"py-3"}),e.jsx("div",{className:"absolute right-4 top-0 h-full flex items-center",children:e.jsx("img",{className:"w-[18px] h-[18px]",src:"/svgs/lock.webp"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(t,{className:"py-3"})})}),e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(d,{className:"py-3"})})})]})]}),e.jsx(Q,{name:"paypal",change:l,checked:f,labelImage:["pay_paypal.webp"],id:"paypal"}),e.jsx(Q,{name:"affirm",change:l,checked:f,id:"affirm",labelImage:["affirm.webp"]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Billing address"}),e.jsx("p",{className:"flex gap-1 items-center text-sm text-b32",children:"Select the address that matches your card of payment method."}),e.jsxs("div",{className:"mt-14px [&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(oe,{checked:O,change:_,name:"shipping_address",id:"shipping_address",title:"Same as shipping address"}),e.jsx(oe,{checked:y,change:_,name:"billing_address",id:"billing_address",title:"Use a different billing address"})]})]})]})},ns=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed flex flex-col space-y-5 items-center justify-center top-0 w-full h-screen z-40 bg-white",children:[e.jsx(ze,{className:"text-b6 text-6xl animate-spin"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Your order’s being processed."}),e.jsx("p",{className:"font-medium text-sm",children:"Please wait while we process your order."})]})]})}),ds=()=>{const r=ue(),t=pe(),d=xe(),C=n(l=>l.order.orderErrors),f=n(l=>l.order.orderStatus),w=n(l=>{var u;return(u=l.cart)==null?void 0:u.cart._id}),o=n(l=>l.order.billingAddress),y=async(l,u)=>{if(C.confirm||!f.confirm){const c=await He({orderNo:u,intent:l,cartId:w});c.status===200?(x(c.data.msg,"success",1e3),N({confirm:!1}),v({confirm:!0}),t(ae()),t(re()),t(h(!1)),d("/mycart/order-success")):(x(c.data.message,"error",1e3),N({confirm:!0}),v({confirm:!1}),t(h(!1)))}else x("Order Already Complete!","success",1e3),t(ae()),t(re()),t(h(!1)),d("/mycart/order-success")};return{handlePaypalPayment:async()=>{x("Paypal Transaction!","success",1e3)},handleAffirmPayment:async(l,u,c)=>{const F=`http://localhost:5173/mycart/order-success/?callback=affirm&order_number=${c}`,p=await le({price:u*100,mode:["affirm"],currency:"usd",description:"Neuappliance Outlet Affirm Transaction"});if(console.log(p),p)try{const P=await r.confirmAffirmPayment(p.data.payIntent.client_secret,{payment_method:{billing_details:{email:o.email,name:`${o.firstName} ${o.lastName}`,address:{line1:o.address,city:o.city,state:o.state,country:"US",postal_code:o.postalCode}}},shipping:{name:`${l.firstName} ${l.lastName}`,address:{line1:l.address,city:l.city,state:l.state,country:"US",postal_code:l.postalCode}},return_url:F});console.log(P)}catch(P){console.log(P),x("Affirm Payment Failed!","error",1e3),t(N({payment:!0})),t(v({payment:!1})),t(h(!1))}else x("Affirm Payment Failed!","error",1e3),t(N({payment:!0})),t(v({payment:!1})),t(h(!1))},ConfirmOrder:y,handleCardPayment:async(l,u,c,F,p,P)=>{const D=l,$=await le({price:F*100,mode:["card"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if($){const S=await r.confirmCardPayment($.data.payIntent.client_secret,{payment_method:{card:D,billing_details:{name:`${p.firstName} ${p.lastName}`,email:p.email,address:{line1:p.address,city:p.city,country:"us",postal_code:p.postalCode,state:p.state}}}});S!=null&&S.error?(t(N({payment:!0})),t(v({payment:!1})),t(h(!1)),x(S.error.code,"error",1e3)):(t(N({payment:!1})),t(v({payment:!0})),t(Ke(S.paymentIntent)),y(S.paymentIntent,P))}else t(N({payment:!0})),t(v({payment:!1})),t(h(!1)),x("Payment Intent Error!","error",1e3)}}},hs=()=>{xe();const r=pe();n(s=>{var a;return(a=s.cart)==null?void 0:a.cart.products});const{ConfirmOrder:t,handleCardPayment:d,handleAffirmPayment:C,handlePaypalPayment:f}=ds(),w=Ye(),o=()=>{const s=new URLSearchParams(w.search),a={};for(const[b,k]of s.entries())a[b]=k;a.callback==="affirm"?(r(h(!0)),t(a.payment_intent,a.order_number)):r(h(!1))};i.useEffect(()=>{o()},[]);const{email:y,address:O,postalCode:q,city:_,country:l,province:u}=n(s=>s.order.orderInfo)||{},c=n(s=>{var a;return(a=s.cart)==null?void 0:a.cart.orderInfo}),F=[{name:"USA",value:"us"}],p=[{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"}],[P,D]=i.useState(""),[$,S]=i.useState(!1),[z,he]=i.useState(""),[H,fe]=i.useState(""),[K,ye]=i.useState(""),[Y,ge]=i.useState(""),[G,be]=i.useState(""),[je,Ne]=i.useState("usa"),[ve,Ce]=i.useState("alberta"),[T,we]=i.useState(""),[I,Pe]=i.useState(""),[Se,Ae]=i.useState(!1),ke=Ge().shape({email:j().required("Email is Required!"),firstName:j().nullable(),lastName:j().required("Last Name is Required!"),address:j().required("Address is Required!"),appartment:j().nullable(),city:j().required("City is Required!"),country:j().required("Country is Required!"),province:j().required("Province is Required!"),postalCode:j().required("Postal Code is Required!"),phone:j().required("Phone is Required!")}),[Re,M]=i.useState(!1),qe=async()=>{M(!0),(await CheckZip({zip:T})).status==200,M(!1)};i.useEffect(()=>{T.length===5&&qe()},[T]);const V=s=>{const{name:a,checked:b}=s.target;a==="keepUpdates"&&S(b),a==="saveAddress"&&Ae(b)},[Z,Ee]=i.useState(!1),[W,_e]=i.useState("card"),[m,J]=i.useState(!1),[L,cs]=i.useState([]),Fe=async()=>{try{const s={email:P,firstName:z,lastName:H,address:K,appartment:Y,city:G,country:je,state:ve,postalCode:q,phone:I};return await ke.validate(s,{abortEarly:!1}),$&&L.push(P),{status:!0,data:s}}catch(s){if(s){let a=s.errors;return J(a),a.forEach(b=>{x(b,"error",1e3)}),{status:!1}}else J([])}},g=n(s=>s.order.orderInfo),X=n(s=>{var a;return(a=s.cart)==null?void 0:a.cart.grandTotal}),$e=n(s=>{var a;return(a=s.cart)==null?void 0:a.cart._id}),Oe=n(s=>s.user._id),Le=n(s=>s.user.auth),A=n(s=>s.order.orderErrors),ee=n(s=>s.order.orderStatus),Ue=ls(),U=Ie(),Be=ue(),se=n(s=>s.order.orderNo),De=n(s=>s.order.paymentIntent);n(s=>s.order.billingAddress);const te=async(s,a)=>{if(A.payment||!ee.payment){if(!Be&&!U){x("Stripe Not Loaded!","error",100),r(N({payment:!0})),r(v({payment:!1})),r(h(!1));return}const b=U.getElement(ie),k=U.getElement(ne),Ze=U.getElement(de);switch(W){case"card":d(b,k,Ze,X.toFixed(2),g,s);break;case"paypal":f();break;case"affirm":C(g,X.toFixed(2),s);break}}else t(De,se)},Te=async s=>{if(s.preventDefault(),r(h(!0)),A.order||!ee.order){let a={status:!1};if(Z?(g!=null&&g.keepUpdates&&L.push(g.email),a=await Fe()):(g!=null&&g.keepUpdates&&L.push(g.email),a={status:!0,data:{...g}}),a.status){r(Xe(a.data));const b={userId:Oe,isAdmin:Ue,isAuth:Le,cartId:$e,shippingAddress:g,billingInfo:a.data,newsEmail:L},k=await es(b);k.status===200?(r(N({order:!1})),r(v({order:!0})),r(ss(k.data.orderNo)),te(k.data.orderNo,a.data)):(r(N({order:!0})),r(v({order:!1})),x(k.data.message,"error",1e3),r(h(!1)))}else x("Billing Address Not Found!","error",1e3),r(h(!1))}else x("Order Already Placed...","success",1e3),te(se)},Me=n(s=>s.order.processing);return e.jsxs(e.Fragment,{children:[Me?e.jsx(ns,{}):null,e.jsxs(ts,{children:[e.jsx("img",{src:"/login_logo.webp",alt:""}),e.jsx(as,{}),e.jsxs("div",{className:"border border-b31 p-3 flex flex-col gap-3 rounded-md",children:[e.jsx(B,{title:"Contact",detail:y,textStyle:"font-medium"}),e.jsx("hr",{}),e.jsx(B,{title:"Ship to",detail:`${O},${_} ,${u}, ${l},${q}`,textStyle:"font-medium"}),e.jsx("hr",{}),(c==null?void 0:c.type)==="delivery"?e.jsx(B,{title:"Method",detail:`Home Delivery · $${c.shipping}`,subtitle:"2 to 3 Business Days",textStyle:"font-medium"}):null,(c==null?void 0:c.type)==="pickup"?e.jsx(B,{title:"Method",detail:"Self Pickup · Free",subtitle:"Always Ready!",textStyle:"font-medium"}):null]}),e.jsx(is,{CardNumber:ie,CardExpiry:ne,CardCvc:de,handleCardPayment:d,payment:W,setPayment:_e,billing:Z,setBilling:Ee}),e.jsxs("div",{className:`${Z?"flex flex-col":"hidden"} duration-300  border-[1px] border-b31 rounded-md mt-3 px-4 py-4`,children:[e.jsxs("div",{className:"space-y-14px [&>*]:text-b16 [&>*]:text-sm",children:[e.jsx("h3",{className:"!text-lg font-medium text-b16",children:"Billing information"}),e.jsx(R,{width:"full",name:"Email",title:"Email",iscompulsory:"false",type:"text",value:P,onChange:s=>D(s.target.value),error:!!(m&&m.includes("Email is Required!")),errormessage:"Email is Required!",placeholder:"abc@gmail.com"}),e.jsx(E.Checkbox,{onChange:s=>V(s),checked:$,defaultChecked:!1,name:"keepUpdates",id:"keep-me-update",label:"Keep me up to date on news and exclusive offers",className:"checked:bg-black border-b31",ripple:!1})]}),e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-b16",children:"Shipping address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(R,{width:"full",name:"firstName",title:"",iscompulsory:"false",type:"text",value:z,onChange:s=>he(s.target.value),error:!!(m&&m.includes("First Name is Required!")),errormessage:"First Name is Required!",placeholder:"First Name (optional)"}),e.jsx(R,{width:"full",name:"lastName",title:"",iscompulsory:"false",type:"text",value:H,onChange:s=>fe(s.target.value),error:!!(m&&m.includes("Last Name is Required!")),errormessage:"Last Name is Required!",placeholder:"Last Name"}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsx(R,{width:"full",name:"address",title:"",iscompulsory:"false",type:"text",value:K,onChange:s=>ye(s.target.value),error:!!(m&&m.includes("Address is Required!")),errormessage:"Address is Required!",placeholder:"Address"}),e.jsx(R,{width:"full",name:"appartment",title:"",iscompulsory:"false",type:"text",value:Y,onChange:s=>ge(s.target.value),error:!!(m&&m.includes("Apartment, suite is Required!")),errormessage:"Apartment, suite is Required!",placeholder:"Apartment, suite, etc. (optional)"}),e.jsx(R,{width:"full",name:"city",title:"",iscompulsory:"false",type:"text",value:G,onChange:s=>be(s.target.value),error:!!(m&&m.includes("City is Required!")),errormessage:"City is Required!",placeholder:"City"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-14px",children:[e.jsx(ce,{setState:Ne,id:"country_region",label:"Country / region",Options:F}),e.jsx(ce,{setState:Ce,id:"province",label:"Province",Options:p}),e.jsxs("div",{className:"relative  col-span-2 md:col-span-1 [&>*]:h-full",children:[Re?e.jsx("div",{className:"absolute flex rounded-lg items-center w-full justify-end px-2",children:e.jsx("img",{src:"/loader-bg.gif",className:"w-4 h-4"})}):null,e.jsx(R,{width:"full",name:"postalCode",title:"",iscompulsory:"false",type:"text",value:q,onChange:s=>we(s.target.value),error:!!(m&&m.includes("Postal Code is Required!")),errormessage:"Postal Code is Required!",placeholder:"Postal Code"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{width:"full",name:"phone",title:"",iscompulsory:"false",type:"text",value:I,onChange:s=>Pe(s.target.value),error:!!(m&&m.includes("Phone is Required!")),errormessage:"Phone is Required!",placeholder:"Phone"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(Ve,{className:"text-2xl text-b3"})})]}),e.jsx("div",{className:"[&>*]:text-b16 [&>*]:text-sm",children:e.jsx(E.Checkbox,{onChange:s=>V(s),id:"save-information",name:"saveAddress",checked:Se,defaultChecked:!1,label:"Save this information for next time",className:"checked:bg-black border-b31",ripple:!1})})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full mt-5",children:[e.jsxs(We,{to:"/mycart/shipping",className:"flex gap-1 items-center",children:[e.jsx(rs,{}),e.jsx("span",{className:"text-sm font-medium text-b3",children:"Return to shipping"})]}),e.jsx("button",{type:"button",onClick:Te,className:`flex space-x-1 cursor-pointer py-3 px-6 text-xs rounded-lg ${A.order||A.payment||A.confirm?"bg-red-500":"bg-b3"} text-white`,children:A.order||A.payment||A.confirm?e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("span",{children:"Try Again"})," ",e.jsx(Je,{className:"text-white text-sm"})]}):e.jsx("span",{children:"Pay Now"})})]})]})]})};export{hs as default};
