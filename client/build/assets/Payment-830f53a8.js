import{r as a,j as e,bO as qe,by as h,n as C,a$ as W,bP as Re,b8 as ke,u as Pe,a2 as Ae,a3 as g,bG as Ee,L as De,z as v}from"./index-19898fbb.js";import{C as _e,B as $e,L as Ie}from"./LeftArrowSvg-661cc38f.js";import{R as k}from"./ReviewDetail-93b5ff30.js";import{C as V}from"./CustomSelect-0b030065.js";import{c as G,a as o}from"./index.esm-1fbe94c9.js";import"./CustomInput-834e97b9.js";const J=({id:x,title:l,labelImage:c,checked:u,name:t,customStyle:b,change:d})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(C.Radio,{id:x,onChange:y=>d(y),icon:e.jsx(W,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:t,label:e.jsx("div",{children:e.jsxs(C.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[c?e.jsx("img",{src:"/payment/"+c,className:"h-[23px] object-contain",alt:l}):null,e.jsx("span",{className:b,children:l})]})}),checked:u})}),L=({id:x,title:l,labelImage:c,checked:u,name:t,customStyle:b,change:d})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx(C.Radio,{id:x,onChange:y=>d(y),icon:e.jsx(W,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:t,label:e.jsx("div",{children:e.jsxs(C.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[c?e.jsx("img",{src:"/payment/"+c,className:"h-[23px] object-contain",alt:l}):null,e.jsx("span",{className:b,children:l})]})}),checked:u===t})}),Le=({payment:x,setPayment:l,setBilling:c,billing:u,card:t,setCard:b,cardErrors:d})=>{const[y,q]=a.useState(!0),R=r=>{const p=r.target;p.name==="shipping_address"&&(q(p.checked),c(!1)),p.name==="billing_address"&&(c(p.checked),q(!1))},w=r=>{l(r.target.name)},P=r=>r.replace(/\s/g,"").slice(0,16).replace(/\d{4}(?!$)/g,"$& "),A=r=>{const p=r.replace(/[^0-9]/g,"").slice(0,6);let N="";for(let j=0;j<p.length;j+=2)j!==0&&(N+="/"),N+=p.substr(j,2);return N};return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Payment"}),e.jsxs("p",{className:"flex gap-1 items-center text-sm text-b32 font-medium",children:[e.jsx(qe,{className:"text-b3 text-xs"})," All transactions are secure and encrypted."]}),e.jsxs("div",{className:"[&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(L,{customStyle:"font-medium",change:w,name:"card_payment",id:"credit_card",title:"Credit card",checked:x}),e.jsxs("div",{className:"p-4 bg-[#F9F9F9] grid grid-cols-1 gap-14px",children:[e.jsx(h,{icon:"lock.webp",width:"full",name:"cardNumber",iscompulsory:"false",type:"text",value:P(t.cardNo),onChange:r=>b({...t,cardNo:t.cardNo.length>15?t.cardNo.replace(/\s/g,"").slice(0,16):r.target.value.replace(/\s/g,"").slice(0,16)}),error:!!(d&&d.includes("Card Number is Required!")),errormessage:"Card Number is Required!",placeholder:"Card number"}),e.jsx(h,{width:"full",name:"cardName",iscompulsory:"false",type:"text",value:t.name,onChange:r=>b({...t,name:r.target.value}),error:!!(d&&d.includes("Card Holder Name is Required!")),errormessage:"Card Holder Name is Required!",placeholder:"Name on card"}),e.jsxs("div",{className:"grid grid-cols-2 gap-14px",children:[e.jsx(h,{width:"full",name:"expDate",iscompulsory:"false",type:"text",value:t.expDate,onChange:r=>b({...t,expDate:A(r.target.value)}),error:!!(d&&d.includes("Card Expiry Date is Required!")),errormessage:"Card Expiry Date is Required!",placeholder:"Expiration date (MM / YY)"}),e.jsx(h,{icon:"question-fill.webp",width:"full",name:"code",iscompulsory:"false",type:"text",value:t.code,onChange:r=>b({...t,code:t.code.length>6?t.code:r.target.value}),error:!!(d&&d.includes("Security Code is Required!")),errormessage:"Security Code is Required!",placeholder:"Security code"})]})]}),e.jsx(L,{name:"paypal_payment",change:w,checked:x,labelImage:"pay_paypal.webp",id:"paypal"}),e.jsx(L,{name:"affirm_payment",change:w,checked:x,id:"affirm",labelImage:"affirm.webp"})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Billing address"}),e.jsx("p",{className:"flex gap-1 items-center text-sm text-b32",children:"Select the address that matches your card of payment method."}),e.jsxs("div",{className:"mt-14px [&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(J,{checked:y,change:R,name:"shipping_address",id:"shipping_address",title:"Same as shipping address"}),e.jsx(J,{checked:u,change:R,name:"billing_address",id:"billing_address",title:"Use a different billing address"})]})]})]})},Be=()=>e.jsxs("div",{className:"fixed flex flex-col space-y-5 items-center justify-center top-0 w-full h-screen z-40 bg-white/80",children:[e.jsx(Re,{className:"text-b6 text-6xl animate-spin"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Your order’s being processed."}),e.jsx("p",{className:"font-medium text-sm",children:"Please wait while we process your order."})]})]}),Fe="",Te=ke.create({baseURL:Fe,headers:{"Content-Type":"application/json"}}),Me=async x=>{let l;try{l=await Te.post("/api/user/process-order",x,{validateStatus:()=>!0})}catch(c){return c}return l},Ge=()=>{const[x,l]=a.useState(!1),c=Pe();Ae();const u=g(s=>s.cart.deliveryOrders),t=g(s=>s.cart.pickupOrders);u.length===0&&t.length===0&&c("/mycart");const{email:b,address:d,postalCode:y,city:q,country:R,province:w}=g(s=>s.order.orderInfo),P=g(s=>s.cart.deliveryInfo),A=[{name:"USA",value:"usa"}],r=[{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"}],[p,N]=a.useState(""),[j,X]=a.useState(!1),[B,ee]=a.useState(""),[F,se]=a.useState(""),[T,ae]=a.useState(""),[M,te]=a.useState(""),[U,re]=a.useState(""),[le,ie]=a.useState("usa"),[de,ne]=a.useState("alberta"),[E,oe]=a.useState(""),[O,ce]=a.useState(""),[ue,me]=a.useState(!1),pe=G().shape({email:o().required("Email is Required!"),firstName:o().nullable(),lastName:o().required("Last Name is Required!"),address:o().required("Address is Required!"),appartment:o().nullable(),city:o().required("City is Required!"),country:o().required("Country is Required!"),province:o().required("Province is Required!"),postalCode:o().required("Postal Code is Required!"),phone:o().required("Phone is Required!")}),[he,D]=a.useState(!1),xe=async()=>{D(!0);const s=await CheckZip({zip:E});console.log(s),s.status==200,D(!1)};a.useEffect(()=>{E.length===5&&xe()},[E]);const H=s=>{const{name:n,checked:m}=s.target;n==="keepUpdates"&&X(m),n==="saveAddress"&&me(m)},[_,fe]=a.useState(!1),[Y,ge]=a.useState("card_payment"),[z,be]=a.useState({cardNo:"",name:"",expDate:"",code:""}),[ye,Z]=a.useState([]),je=G().shape({cardNo:o().matches(/^\d{16}$/,"Must be exactly 16 digits").required("Card Number is Required!"),name:o().required("Card Holder Name is Required!"),expDate:o().required("Card Expiry Date is Required!"),code:o().required("Security Code is Required!")}),[i,K]=a.useState(!1),[S,Ue]=a.useState([]),[$,Oe]=a.useState((u==null?void 0:u.length)>0?"delivery":"pickup"),Ne=async()=>{try{return await je.validate(z,{abortEarly:!1}),{status:!0,data:"card"}}catch(s){if(s){let n=s.errors;return Z(n),n.forEach(m=>{v(m,"error",1e3)}),{status:!0}}else Z([])}},ve=async()=>({status:!0,data:"affirm"}),Ce=async()=>({status:!0,data:"paypal"}),we=async()=>{try{const s={email:p,firstName:B,lastName:F,address:T,appartment:M,city:U,country:le,province:de,postalCode:y,phone:O};return await pe.validate(s,{abortEarly:!1}),j&&S.push(p),{status:!0,data:s}}catch(s){if(s){let n=s.errors;return K(n),n.forEach(m=>{v(m,"error",1e3)}),{status:!1}}else K([])}},f=g(s=>s.order.orderInfo);g(s=>s.cart.pickupInfo),g(s=>s.cart.tax),g(s=>s.cart.total),g(s=>s.cart.grandTotal);const Q=g(s=>s.cart.cartId);g(s=>s.user.cartId);const Se=async s=>{s.preventDefault(),l(!0);let n={status:!1};_?(f!=null&&f.keepUpdates&&S.push(f.email),n=await we()):(f!=null&&f.keepUpdates&&S.push(f.email),n={status:!0,data:{...f}});let m;if(n.status){switch(Y){case"card_payment":m=await Ne();break;case"affirm_payment":m=await ve();break;case"paypal_payment":m=await Ce();break}if(m.status){let I;$==="delivery"?I={cartId:Q,orderType:$,paymentInfo:m.data,shippingAddress:f,billingInfo:n.data,newsEmail:S}:I={cartId:Q,orderType:$,paymentInfo:m.data,shippingAddress:f,billingInfo:n.data,newsEmail:S},(await Me(I)).status===200?(v("Order Successfully Placed!","success",1e3),l(!1),c("/mycart/order-success")):(v("Order Processing Error!","error",1e3),l(!1))}else v("Payment Processor Error!","error",1e3),l(!1)}else v("Billing Address Error!","error",1e3),l(!1)};return e.jsxs(e.Fragment,{children:["  ",x?e.jsx(Be,{}):e.jsxs(_e,{children:[e.jsx("img",{src:"/login_logo.webp",alt:""}),e.jsx($e,{}),e.jsxs("div",{className:"border border-b31 p-3 flex flex-col gap-3 rounded-md",children:[e.jsx(k,{title:"Contact",detail:b,textStyle:"font-medium"}),e.jsx("hr",{}),e.jsx(k,{title:"Ship to",detail:`${d},${q} ,${w}, ${R},${y}`,textStyle:"font-medium"}),e.jsx("hr",{}),(u==null?void 0:u.length)>0?e.jsx(k,{title:"Method",detail:`Home Delivery · $${P.shipping}`,subtitle:"1 to 3 Business Days",textStyle:"font-medium"}):null,(t==null?void 0:t.length)>0?e.jsx(k,{title:"Method",detail:"Self Pickup · Free",subtitle:"Always Ready!",textStyle:"font-medium"}):null]}),e.jsx(Le,{card:z,setCard:be,cardErrors:ye,payment:Y,setPayment:ge,billing:_,setBilling:fe}),e.jsxs("div",{className:`${_?"flex flex-col":"hidden"} duration-300  border-[1px] border-b31 rounded-md mt-3 px-4 py-4`,children:[e.jsxs("div",{className:"space-y-14px [&>*]:text-b16 [&>*]:text-sm",children:[e.jsx("h3",{className:"!text-lg font-medium text-b16",children:"Billing information"}),e.jsx(h,{width:"full",name:"Email",title:"Email",iscompulsory:"false",type:"text",value:p,onChange:s=>N(s.target.value),error:!!(i&&i.includes("Email is Required!")),errormessage:"Email is Required!",placeholder:"abc@gmail.com"}),e.jsx(C.Checkbox,{onChange:s=>H(s),checked:j,defaultChecked:!1,name:"keepUpdates",id:"keep-me-update",label:"Keep me up to date on news and exclusive offers",className:"checked:bg-black border-b31",ripple:!1})]}),e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-b16",children:"Shipping address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(h,{width:"full",name:"firstName",title:"",iscompulsory:"false",type:"text",value:B,onChange:s=>ee(s.target.value),error:!!(i&&i.includes("First Name is Required!")),errormessage:"First Name is Required!",placeholder:"First Name (optional)"}),e.jsx(h,{width:"full",name:"lastName",title:"",iscompulsory:"false",type:"text",value:F,onChange:s=>se(s.target.value),error:!!(i&&i.includes("Last Name is Required!")),errormessage:"Last Name is Required!",placeholder:"Last Name"}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsx(h,{width:"full",name:"address",title:"",iscompulsory:"false",type:"text",value:T,onChange:s=>ae(s.target.value),error:!!(i&&i.includes("Address is Required!")),errormessage:"Address is Required!",placeholder:"Address"}),e.jsx(h,{width:"full",name:"appartment",title:"",iscompulsory:"false",type:"text",value:M,onChange:s=>te(s.target.value),error:!!(i&&i.includes("Apartment, suite is Required!")),errormessage:"Apartment, suite is Required!",placeholder:"Apartment, suite, etc. (optional)"}),e.jsx(h,{width:"full",name:"city",title:"",iscompulsory:"false",type:"text",value:U,onChange:s=>re(s.target.value),error:!!(i&&i.includes("City is Required!")),errormessage:"City is Required!",placeholder:"City"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-14px",children:[e.jsx(V,{setState:ie,id:"country_region",label:"Country / region",Options:A}),e.jsx(V,{setState:ne,id:"province",label:"Province",Options:r}),e.jsxs("div",{className:"relative  col-span-2 md:col-span-1 [&>*]:h-full",children:[he?e.jsx("div",{className:"absolute flex rounded-lg items-center w-full justify-end px-2",children:e.jsx("img",{src:"/loader-bg.gif",className:"w-4 h-4"})}):null,e.jsx(h,{width:"full",name:"postalCode",title:"",iscompulsory:"false",type:"text",value:y,onChange:s=>oe(s.target.value),error:!!(i&&i.includes("Postal Code is Required!")),errormessage:"Postal Code is Required!",placeholder:"Postal Code"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{width:"full",name:"phone",title:"",iscompulsory:"false",type:"text",value:O,onChange:s=>ce(s.target.value),error:!!(i&&i.includes("Phone is Required!")),errormessage:"Phone is Required!",placeholder:"Phone"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(Ee,{className:"text-2xl text-b3"})})]}),e.jsx("div",{className:"[&>*]:text-b16 [&>*]:text-sm",children:e.jsx(C.Checkbox,{onChange:s=>H(s),id:"save-information",name:"saveAddress",checked:ue,defaultChecked:!1,label:"Save this information for next time",className:"checked:bg-black border-b31",ripple:!1})})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full mt-5",children:[e.jsxs(De,{to:"/mycart/shipping",className:"flex gap-1 items-center",children:[e.jsx(Ie,{}),e.jsx("span",{className:"text-sm font-medium text-b3",children:"Return to shipping"})]}),e.jsx("button",{type:"button",onClick:s=>Se(s),className:"py-3 px-6 text-xs rounded-lg bg-b3 text-white",children:"Pay Now"})]})]})]})};export{Ge as default};
