import{a5 as c,r as l,j as e,bY as Me,aW as $,b4 as de,bZ as Ze,b_ as oe,a6 as me,u as ue,b$ as Qe,w as g,c0 as j,c1 as N,ap as ze,aq as He,c2 as f,c3 as Q,c4 as Ke,y as Ye,p as Ge,q as w,c5 as Ve,c6 as re,c7 as ne,c8 as ie,av as A,aU as We,L as Je,aS as Xe,c9 as es,ca as ss,cb as ts}from"./index-554f52d4.js";import{C as as,B as rs,L as ns}from"./LeftArrowSvg-a922bc39.js";import{R as T}from"./ReviewDetail-62c7cc39.js";import{C as le}from"./CustomSelect-8c09ea76.js";import"./CustomInput-3cf54bf8.js";const is=()=>{const r=c(d=>d.admin._id),t=c(d=>d.user._id);if(r)return!0;if(t&&!r||!r&&!t)return!1},ce=({id:r,title:t,labelImage:d,checked:P,name:x,customStyle:S,change:b})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx($.Radio,{id:r,onChange:v=>b(v),icon:e.jsx(de,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:x,label:e.jsx("div",{children:e.jsxs($.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[d?e.jsx("img",{src:"/payment/"+d,className:"h-[23px] object-contain",alt:t}):null,e.jsx("span",{className:S,children:t})]})}),checked:P})}),z=({id:r,title:t,labelImage:d,checked:P,name:x,customStyle:S,change:b})=>e.jsx("div",{className:"flex justify-between w-full gap-3 p-4",children:e.jsx($.Radio,{id:r,onChange:v=>b(v),icon:e.jsx(de,{className:"w-[18px] h-[18px]"}),className:"border border-[#D9D9D9] bg-white p-0 w-[18px] h-[18px]",ripple:!1,name:x,label:e.jsx("div",{children:e.jsxs($.Typography,{className:"font-medium tracking-032 flex items-center gap-1 text-sm text-b16",children:[(d==null?void 0:d.length)>0?d.map(v=>e.jsx("img",{src:"/payment/"+v,className:"h-[23px] object-contain",alt:t})):null,e.jsx("span",{className:S,children:t})]})}),checked:P===x})}),ls=({CardNumber:r,CardExpiry:t,CardCvc:d,handleCardPayment:P,payment:x,setPayment:S,setBilling:b,billing:v})=>{const[L,E]=l.useState(!0),i=u=>{const n=u.target;n.name==="shipping_address"&&(E(n.checked),b(!1)),n.name==="billing_address"&&(b(n.checked),E(!1))},m=u=>{S(u.target.name)};return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Payment"}),e.jsxs("p",{className:"flex gap-1 items-center text-sm text-b32 font-medium",children:[e.jsx(Me,{className:"text-b3 text-xs"})," All transactions are secure and encrypted."]}),e.jsxs("div",{className:"[&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(z,{customStyle:"font-medium",change:m,name:"card",id:"credit_card",checked:x,labelImage:["visa.png","master.png","express.png"]}),e.jsxs("form",{onSubmit:P,className:"p-4 bg-[#F9F9F9] grid grid-cols-1 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsxs("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:[e.jsx(r,{className:"py-3"}),e.jsx("div",{className:"absolute right-4 top-0 h-full flex items-center",children:e.jsx("img",{className:"w-[18px] h-[18px]",src:"/svgs/lock.webp"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-14px",children:[e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(t,{className:"py-3"})})}),e.jsx("div",{className:"relative flex justify-center items-center h-10 bg-[#F9F9F9]",children:e.jsx("div",{className:"bg-white text-sm outline-none border-[1px] border-b31 w-full px-4 h-10 rounded-lg",children:e.jsx(d,{className:"py-3"})})})]})]}),e.jsx(z,{name:"paypal",change:m,checked:x,labelImage:["pay_paypal.webp"],id:"paypal"}),e.jsx(z,{name:"affirm",change:m,checked:x,id:"affirm",labelImage:["affirm.webp"]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-medium text-b16",children:"Billing address"}),e.jsx("p",{className:"flex gap-1 items-center text-sm text-b32",children:"Select the address that matches your card of payment method."}),e.jsxs("div",{className:"mt-14px [&>*]:border-b [&>*]:border-b31 [&>*:last-child]:border-0 border border-b31 rounded-md",children:[e.jsx(ce,{checked:L,change:i,name:"shipping_address",id:"shipping_address",title:"Same as shipping address"}),e.jsx(ce,{checked:v,change:i,name:"billing_address",id:"billing_address",title:"Use a different billing address"})]})]})]})},cs=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed flex flex-col space-y-5 items-center justify-center top-0 w-full h-screen z-40 bg-white",children:[e.jsx(Ze,{className:"text-b6 text-6xl animate-spin"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Your order’s being processed."}),e.jsx("p",{className:"font-medium text-sm",children:"Please wait while we process your order."})]})]})}),ds=()=>{const r=oe(),t=me(),d=ue(),P=c(i=>i.order.orderErrors),x=c(i=>i.order.orderStatus),S=c(i=>{var m;return(m=i.cart)==null?void 0:m.cart._id});c(i=>i.order.billingAddress);const b=async(i,m)=>{if(P.confirm||!x.confirm){console.log("confiremd1");const u=await Qe({orderNo:m,intent:i,cartId:S});u.status===200?(g(u.data.msg,"success",1e3),j({confirm:!1}),N({confirm:!0}),t(ze()),t(He()),t(f(!1)),d("/mycart/order-success")):(g(u.data.message,"error",1e3),j({confirm:!0}),N({confirm:!1}),t(f(!1)))}};return{handlePaypalPayment:async(i,m)=>{const u=`https://neuoutletapp-03ffb1b9719f.herokuapp.com/mycart/payment/?callback=paypal&order_number=${m}`,n=await Q({price:i*100,mode:["paypal"],currency:"usd",description:"Neuappliance Outlet Paypal Transaction"});if(console.log(n),n.data.status===200){const p=await r.confirmPayPalPayment(n.data.payIntent.client_secret,{return_url:u});console.log(p)}else g(n.data.message,"error",1e3),t(f(!1))},handleAffirmPayment:async(i,m,u,n)=>{const p=`https://neuoutletapp-03ffb1b9719f.herokuapp.com/mycart/payment/?callback=affirm&order_number=${u}`,_=await Q({price:m*100,mode:["affirm"],currency:"usd",description:"Neuappliance Outlet Affirm Transaction"}),q=`${i.firstName} ${i.lastName}`,F=`${n.firstName} ${n.lastName}`;if(_)try{const h=await r.confirmAffirmPayment(_.data.payIntent.client_secret,{payment_method:{billing_details:{email:n.email,name:F,address:{line1:n.address,city:n.city,state:"CA",country:"US",postal_code:n.postalCode}}},shipping:{name:q,address:{line1:i.address,city:i.city,state:"CA",country:"US",postal_code:i.postalCode}},return_url:p})}catch(h){console.log(h),g("Affirm Payment Failed!","error",1e3),t(j({payment:!0})),t(N({payment:!1})),t(f(!1))}else g("Affirm Payment Failed!","error",1e3),t(j({payment:!0})),t(N({payment:!1})),t(f(!1))},ConfirmOrder:b,handleCardPayment:async(i,m,u,n,p,_)=>{const q=i,F=await Q({price:n*100,mode:["card"],currency:"usd",description:"Neuappliance Outlet Card Transaction"});if(F){const h=await r.confirmCardPayment(F.data.payIntent.client_secret,{payment_method:{card:q,billing_details:{name:`${p.firstName} ${p.lastName}`,email:p.email,address:{line1:p.address,city:p.city,country:"us",postal_code:p.postalCode,state:p.state}}}});h!=null&&h.error?(t(j({payment:!0})),t(N({payment:!1})),t(f(!1)),g(h.error.code,"error",1e3)):(t(j({payment:!1})),t(N({payment:!0})),t(Ke(h.paymentIntent)),b(h.paymentIntent,_))}else t(j({payment:!0})),t(N({payment:!1})),t(f(!1)),g("Payment Intent Error!","error",1e3)}}},hs=()=>{ue();const r=me();c(s=>{var a;return(a=s.cart)==null?void 0:a.cart.products});const{ConfirmOrder:t,handleCardPayment:d,handleAffirmPayment:P,handlePaypalPayment:x}=ds(),S=Ye(),b=()=>{const s=new URLSearchParams(S.search),a={};for(const[C,R]of s.entries())a[C]=R;a.callback==="affirm"?(r(f(!0)),r(j({payment:!0})),r(N({payment:!1})),t({id:a.payment_intent,created:Date.now(),payment_method_types:["affirm"]},a.order_number)):r(f(!1))};l.useEffect(()=>{b()},[]);const{email:v,address:L,postalCode:E,city:i,country:m,province:u}=c(s=>s.order.orderInfo)||{},n=c(s=>{var a;return(a=s.cart)==null?void 0:a.cart.orderInfo}),p=[{name:"USA",value:"us"}],_=[{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"},{name:"Alberta",value:"alberta"}],[q,F]=l.useState(""),[h,pe]=l.useState(!1),[H,fe]=l.useState(""),[K,xe]=l.useState(""),[Y,he]=l.useState(""),[G,ye]=l.useState(""),[V,ge]=l.useState(""),[be,je]=l.useState("usa"),[Ne,ve]=l.useState("alberta"),[B,Ce]=l.useState(""),[W,we]=l.useState(""),[Pe,Se]=l.useState(!1),ke=Ge().shape({email:w().required("Email is Required!"),firstName:w().nullable(),lastName:w().required("Last Name is Required!"),address:w().required("Address is Required!"),appartment:w().nullable(),city:w().required("City is Required!"),country:w().required("Country is Required!"),province:w().required("Province is Required!"),postalCode:w().required("Postal Code is Required!"),phone:w().required("Phone is Required!")}),[Re,I]=l.useState(!1),Ae=async()=>{I(!0),(await CheckZip({zip:B})).status==200,I(!1)};l.useEffect(()=>{B.length===5&&Ae()},[B]);const J=s=>{const{name:a,checked:C}=s.target;a==="keepUpdates"&&pe(C),a==="saveAddress"&&Se(C)},[M,Ee]=l.useState(!1),[X,qe]=l.useState("card"),[o,ee]=l.useState(!1),[O,os]=l.useState([]),_e=async()=>{try{const s={email:q,firstName:H,lastName:K,address:Y,appartment:G,city:V,country:be,state:Ne,postalCode:E,phone:W};return await ke.validate(s,{abortEarly:!1}),h&&O.push(q),{status:!0,data:s}}catch(s){if(s){let a=s.errors;return ee(a),a.forEach(C=>{g(C,"error",1e3)}),{status:!1}}else ee([])}},y=c(s=>s.order.orderInfo),Z=c(s=>{var a;return(a=s.cart)==null?void 0:a.cart.grandTotal}),Fe=c(s=>{var a;return(a=s.cart)==null?void 0:a.cart._id}),$e=c(s=>s.user._id),Le=c(s=>s.user.auth),k=c(s=>s.order.orderErrors),se=c(s=>s.order.orderStatus),Oe=is(),D=Ve(),De=oe(),te=c(s=>s.order.orderNo),Ue=c(s=>s.order.paymentIntent),U=c(s=>s.order.billingAddress),ae=async(s,a)=>{if(k.payment||!se.payment){if(!De&&!D){g("Stripe Not Loaded!","error",100),r(j({payment:!0})),r(N({payment:!1})),r(f(!1));return}const C=D.getElement(re),R=D.getElement(ne),Ie=D.getElement(ie);switch(X){case"card":d(C,R,Ie,Z.toFixed(2),y,s);break;case"paypal":x(Z.toFixed(2),s);break;case"affirm":P(y,Z.toFixed(2),s,U!=null&&U.email?U:a);break}}else t(Ue,te)},Te=async s=>{if(s.preventDefault(),r(f(!0)),k.order||!se.order){let a={status:!1};if(M?(y!=null&&y.keepUpdates&&O.push(y.email),a=await _e()):(y!=null&&y.keepUpdates&&O.push(y.email),a={status:!0,data:{...y}}),a.status){r(es(a.data));const C={userId:$e,isAdmin:Oe,isAuth:Le,cartId:Fe,shippingAddress:y,billingInfo:a.data,newsEmail:O},R=await ss(C);R.status===200?(r(j({order:!1})),r(N({order:!0})),r(ts(R.data.orderNo)),ae(R.data.orderNo,a.data)):(r(j({order:!0})),r(N({order:!1})),g(R.data.message,"error",1e3),r(f(!1)))}else g("Billing Address Not Found!","error",1e3),r(f(!1))}else g("Order Already Placed...","success",1e3),ae(te)},Be=c(s=>s.order.processing);return e.jsxs(e.Fragment,{children:[Be?e.jsx(cs,{}):null,e.jsxs(as,{children:[e.jsx("img",{src:"/login_logo.webp",alt:""}),e.jsx(rs,{}),e.jsxs("div",{className:"border border-b31 p-3 flex flex-col gap-3 rounded-md",children:[e.jsx(T,{title:"Contact",detail:v,textStyle:"font-medium"}),e.jsx("hr",{}),e.jsx(T,{title:"Ship to",detail:`${L},${i} ,${u}, ${m},${E}`,textStyle:"font-medium"}),e.jsx("hr",{}),(n==null?void 0:n.type)==="delivery"?e.jsx(T,{title:"Method",detail:`Home Delivery · $${n.shipping}`,subtitle:"2 to 3 Business Days",textStyle:"font-medium"}):null,(n==null?void 0:n.type)==="pickup"?e.jsx(T,{title:"Method",detail:"Self Pickup · Free",subtitle:"Always Ready!",textStyle:"font-medium"}):null]}),e.jsx(ls,{CardNumber:re,CardExpiry:ne,CardCvc:ie,handleCardPayment:d,payment:X,setPayment:qe,billing:M,setBilling:Ee}),e.jsxs("div",{className:`${M?"flex flex-col":"hidden"} duration-300  border-[1px] border-b31 rounded-md mt-3 px-4 py-4`,children:[e.jsxs("div",{className:"space-y-14px [&>*]:text-b16 [&>*]:text-sm",children:[e.jsx("h3",{className:"!text-lg font-medium text-b16",children:"Billing information"}),e.jsx(A,{width:"full",name:"Email",title:"Email",iscompulsory:"false",type:"text",value:q,onChange:s=>F(s.target.value),error:!!(o&&o.includes("Email is Required!")),errormessage:"Email is Required!",placeholder:"abc@gmail.com"}),e.jsx($.Checkbox,{onChange:s=>J(s),checked:h,defaultChecked:!1,name:"keepUpdates",id:"keep-me-update",label:"Keep me up to date on news and exclusive offers",className:"checked:bg-black border-b31",ripple:!1})]}),e.jsxs("div",{className:"space-y-14px mt-8",children:[e.jsx("h3",{className:"text-sm font-medium text-b16",children:"Shipping address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(A,{width:"full",name:"firstName",title:"",iscompulsory:"false",type:"text",value:H,onChange:s=>fe(s.target.value),error:!!(o&&o.includes("First Name is Required!")),errormessage:"First Name is Required!",placeholder:"First Name (optional)"}),e.jsx(A,{width:"full",name:"lastName",title:"",iscompulsory:"false",type:"text",value:K,onChange:s=>xe(s.target.value),error:!!(o&&o.includes("Last Name is Required!")),errormessage:"Last Name is Required!",placeholder:"Last Name"}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsx(A,{width:"full",name:"address",title:"",iscompulsory:"false",type:"text",value:Y,onChange:s=>he(s.target.value),error:!!(o&&o.includes("Address is Required!")),errormessage:"Address is Required!",placeholder:"Address"}),e.jsx(A,{width:"full",name:"appartment",title:"",iscompulsory:"false",type:"text",value:G,onChange:s=>ye(s.target.value),error:!!(o&&o.includes("Apartment, suite is Required!")),errormessage:"Apartment, suite is Required!",placeholder:"Apartment, suite, etc. (optional)"}),e.jsx(A,{width:"full",name:"city",title:"",iscompulsory:"false",type:"text",value:V,onChange:s=>ge(s.target.value),error:!!(o&&o.includes("City is Required!")),errormessage:"City is Required!",placeholder:"City"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-14px",children:[e.jsx(le,{setState:je,id:"country_region",label:"Country / region",Options:p}),e.jsx(le,{setState:ve,id:"province",label:"Province",Options:_}),e.jsxs("div",{className:"relative  col-span-2 md:col-span-1 [&>*]:h-full",children:[Re?e.jsx("div",{className:"absolute flex rounded-lg items-center w-full justify-end px-2",children:e.jsx("img",{src:"/loader-bg.gif",className:"w-4 h-4"})}):null,e.jsx(A,{width:"full",name:"postalCode",title:"",iscompulsory:"false",type:"text",value:E,onChange:s=>Ce(s.target.value),error:!!(o&&o.includes("Postal Code is Required!")),errormessage:"Postal Code is Required!",placeholder:"Postal Code"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{width:"full",name:"phone",title:"",iscompulsory:"false",type:"text",value:W,onChange:s=>we(s.target.value),error:!!(o&&o.includes("Phone is Required!")),errormessage:"Phone is Required!",placeholder:"Phone"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(We,{className:"text-2xl text-b3"})})]}),e.jsx("div",{className:"[&>*]:text-b16 [&>*]:text-sm",children:e.jsx($.Checkbox,{onChange:s=>J(s),id:"save-information",name:"saveAddress",checked:Pe,defaultChecked:!1,label:"Save this information for next time",className:"checked:bg-black border-b31",ripple:!1})})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center w-full mt-5",children:[e.jsxs(Je,{to:"/mycart/shipping",className:"flex gap-1 items-center",children:[e.jsx(ns,{}),e.jsx("span",{className:"text-sm font-medium text-b3",children:"Return to shipping"})]}),e.jsx("button",{type:"button",onClick:Te,className:`flex space-x-1 cursor-pointer py-3 px-6 text-xs rounded-lg ${k.order||k.payment||k.confirm?"bg-red-500":"bg-b3"} text-white`,children:k.order||k.payment||k.confirm?e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("span",{children:"Try Again"})," ",e.jsx(Xe,{className:"text-white text-sm"})]}):e.jsx("span",{children:"Pay Now"})})]})]})]})};export{hs as default};
